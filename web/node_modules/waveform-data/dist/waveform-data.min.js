!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).WaveformData=e()}(this,(function(){"use strict";function t(t,e){this._waveformData=t,this._channelIndex=e}t.prototype.min_sample=function(t){var e=2*(t*this._waveformData.channels+this._channelIndex);return this._waveformData._at(e)},t.prototype.max_sample=function(t){var e=2*(t*this._waveformData.channels+this._channelIndex)+1;return this._waveformData._at(e)},t.prototype.set_min_sample=function(t,e){var n=2*(t*this._waveformData.channels+this._channelIndex);return this._waveformData._set_at(n,e)},t.prototype.set_max_sample=function(t,e){var n=2*(t*this._waveformData.channels+this._channelIndex)+1;return this._waveformData._set_at(n,e)},t.prototype.min_array=function(){for(var t=this._waveformData.length,e=[],n=0;n<t;n++)e.push(this.min_sample(n));return e},t.prototype.max_array=function(){for(var t=this._waveformData.length,e=[],n=0;n<t;n++)e.push(this.max_sample(n));return e};var e=127,n=-128,a=32767,i=-32768;function s(t){var s,r,g=t.scale,h=t.amplitude_scale,I=t.split_channels,l=t.length,o=t.sample_rate,u=t.channels.map((function(t){return new Float32Array(t)})),C=I?u.length:1,c=function(t,e){var n=Math.floor(t/e);return t-n*e>0&&n++,n}(l,g),_=8===t.bits?1:2,A=new ArrayBuffer(24+2*c*_*C),m=new DataView(A),d=0,p=24,b=new Array(C),f=new Array(C);for(s=0;s<C;s++)b[s]=1/0,f[s]=-1/0;var Z=8===t.bits?n:i,W=8===t.bits?e:a;for(m.setInt32(0,2,!0),m.setUint32(4,8===t.bits,!0),m.setInt32(8,o,!0),m.setInt32(12,g,!0),m.setInt32(16,c,!0),m.setInt32(20,C,!0),r=0;r<l;r++){var w=0;if(1===C){for(s=0;s<u.length;++s)w+=u[s][r];(w=Math.floor(W*w*h/u.length))<b[0]&&(b[0]=w,b[0]<Z&&(b[0]=Z)),w>f[0]&&(f[0]=w,f[0]>W&&(f[0]=W))}else for(s=0;s<C;++s)(w=Math.floor(W*u[s][r]*h))<b[s]&&(b[s]=w,b[s]<Z&&(b[s]=Z)),w>f[s]&&(f[s]=w,f[s]>W&&(f[s]=W));if(++d===g){for(s=0;s<C;s++)8===t.bits?(m.setInt8(p++,b[s]),m.setInt8(p++,f[s])):(m.setInt16(p,b[s],!0),m.setInt16(p+2,f[s],!0),p+=4),b[s]=1/0,f[s]=-1/0;d=0}}if(d>0)for(s=0;s<C;s++)8===t.bits?(m.setInt8(p++,b[s]),m.setInt8(p++,f[s])):(m.setInt16(p,b[s],!0),m.setInt16(p+2,f[s],!0));return A}function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}var g=null;try{var h="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads");g=h.Worker}catch(t){}function I(t,e,n){var a=void 0===e?null:e,i=function(t,e){return Buffer.from(t,"base64").toString(e?"utf16":"utf8")}(t,void 0!==n&&n),s=i.indexOf("\n",10)+1,r=i.substring(s)+(a?"//# sourceMappingURL="+a:"");return function(t){return new g(r,Object.assign({},t,{eval:!0}))}}function l(t,e,n){var a=void 0===e?null:e,i=function(t,e){var n=atob(t);if(e){for(var a=new Uint8Array(n.length),i=0,s=n.length;i<s;++i)a[i]=n.charCodeAt(i);return String.fromCharCode.apply(null,new Uint16Array(a.buffer))}return n}(t,void 0!==n&&n),s=i.indexOf("\n",10)+1,r=i.substring(s)+(a?"//# sourceMappingURL="+a:""),g=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(g)}var o="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);function u(t,e,n){return o?I(t,e,n):function(t,e,n){var a;return function(i){return a=a||l(t,e,n),new Worker(a,i)}}(t,e,n)}var C=u("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogQXVkaW9CdWZmZXItYmFzZWQgV2F2ZWZvcm1EYXRhIGdlbmVyYXRvcgogICAqCiAgICogQWRhcHRlZCBmcm9tIEJsb2NrRmlsZTo6Q2FsY1N1bW1hcnkgaW4gQXVkYWNpdHksIHdpdGggcGVybWlzc2lvbi4KICAgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2F1ZGFjaXR5L2F1ZGFjaXR5L2Jsb2IvCiAgICogICAxMTA4YzEzNzZjMDkxNjYxNjIzMzVmYWI0NzQzMDA4Y2JhNTdjNGVlL3NyYy9CbG9ja0ZpbGUuY3BwI0wxOTgKICAgKi8KCiAgdmFyIElOVDhfTUFYID0gMTI3OwogIHZhciBJTlQ4X01JTiA9IC0xMjg7CiAgdmFyIElOVDE2X01BWCA9IDMyNzY3OwogIHZhciBJTlQxNl9NSU4gPSAtMzI3Njg7CiAgZnVuY3Rpb24gY2FsY3VsYXRlV2F2ZWZvcm1EYXRhTGVuZ3RoKGF1ZGlvX3NhbXBsZV9jb3VudCwgc2NhbGUpIHsKICAgIHZhciBkYXRhX2xlbmd0aCA9IE1hdGguZmxvb3IoYXVkaW9fc2FtcGxlX2NvdW50IC8gc2NhbGUpOwogICAgdmFyIHNhbXBsZXNfcmVtYWluaW5nID0gYXVkaW9fc2FtcGxlX2NvdW50IC0gZGF0YV9sZW5ndGggKiBzY2FsZTsKICAgIGlmIChzYW1wbGVzX3JlbWFpbmluZyA+IDApIHsKICAgICAgZGF0YV9sZW5ndGgrKzsKICAgIH0KICAgIHJldHVybiBkYXRhX2xlbmd0aDsKICB9CiAgZnVuY3Rpb24gZ2VuZXJhdGVXYXZlZm9ybURhdGEob3B0aW9ucykgewogICAgdmFyIHNjYWxlID0gb3B0aW9ucy5zY2FsZTsKICAgIHZhciBhbXBsaXR1ZGVfc2NhbGUgPSBvcHRpb25zLmFtcGxpdHVkZV9zY2FsZTsKICAgIHZhciBzcGxpdF9jaGFubmVscyA9IG9wdGlvbnMuc3BsaXRfY2hhbm5lbHM7CiAgICB2YXIgbGVuZ3RoID0gb3B0aW9ucy5sZW5ndGg7CiAgICB2YXIgc2FtcGxlX3JhdGUgPSBvcHRpb25zLnNhbXBsZV9yYXRlOwogICAgdmFyIGNoYW5uZWxzID0gb3B0aW9ucy5jaGFubmVscy5tYXAoZnVuY3Rpb24gKGNoYW5uZWwpIHsKICAgICAgcmV0dXJuIG5ldyBGbG9hdDMyQXJyYXkoY2hhbm5lbCk7CiAgICB9KTsKICAgIHZhciBvdXRwdXRfY2hhbm5lbHMgPSBzcGxpdF9jaGFubmVscyA/IGNoYW5uZWxzLmxlbmd0aCA6IDE7CiAgICB2YXIgaGVhZGVyX3NpemUgPSAyNDsKICAgIHZhciBkYXRhX2xlbmd0aCA9IGNhbGN1bGF0ZVdhdmVmb3JtRGF0YUxlbmd0aChsZW5ndGgsIHNjYWxlKTsKICAgIHZhciBieXRlc19wZXJfc2FtcGxlID0gb3B0aW9ucy5iaXRzID09PSA4ID8gMSA6IDI7CiAgICB2YXIgdG90YWxfc2l6ZSA9IGhlYWRlcl9zaXplICsgZGF0YV9sZW5ndGggKiAyICogYnl0ZXNfcGVyX3NhbXBsZSAqIG91dHB1dF9jaGFubmVsczsKICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIodG90YWxfc2l6ZSk7CiAgICB2YXIgZGF0YV92aWV3ID0gbmV3IERhdGFWaWV3KGJ1ZmZlcik7CiAgICB2YXIgc2NhbGVfY291bnRlciA9IDA7CiAgICB2YXIgb2Zmc2V0ID0gaGVhZGVyX3NpemU7CiAgICB2YXIgY2hhbm5lbCwgaTsKICAgIHZhciBtaW5fdmFsdWUgPSBuZXcgQXJyYXkob3V0cHV0X2NoYW5uZWxzKTsKICAgIHZhciBtYXhfdmFsdWUgPSBuZXcgQXJyYXkob3V0cHV0X2NoYW5uZWxzKTsKICAgIGZvciAoY2hhbm5lbCA9IDA7IGNoYW5uZWwgPCBvdXRwdXRfY2hhbm5lbHM7IGNoYW5uZWwrKykgewogICAgICBtaW5fdmFsdWVbY2hhbm5lbF0gPSBJbmZpbml0eTsKICAgICAgbWF4X3ZhbHVlW2NoYW5uZWxdID0gLUluZmluaXR5OwogICAgfQogICAgdmFyIHJhbmdlX21pbiA9IG9wdGlvbnMuYml0cyA9PT0gOCA/IElOVDhfTUlOIDogSU5UMTZfTUlOOwogICAgdmFyIHJhbmdlX21heCA9IG9wdGlvbnMuYml0cyA9PT0gOCA/IElOVDhfTUFYIDogSU5UMTZfTUFYOwogICAgZGF0YV92aWV3LnNldEludDMyKDAsIDIsIHRydWUpOyAvLyBWZXJzaW9uCiAgICBkYXRhX3ZpZXcuc2V0VWludDMyKDQsIG9wdGlvbnMuYml0cyA9PT0gOCwgdHJ1ZSk7IC8vIElzIDggYml0PwogICAgZGF0YV92aWV3LnNldEludDMyKDgsIHNhbXBsZV9yYXRlLCB0cnVlKTsgLy8gU2FtcGxlIHJhdGUKICAgIGRhdGFfdmlldy5zZXRJbnQzMigxMiwgc2NhbGUsIHRydWUpOyAvLyBTY2FsZQogICAgZGF0YV92aWV3LnNldEludDMyKDE2LCBkYXRhX2xlbmd0aCwgdHJ1ZSk7IC8vIExlbmd0aAogICAgZGF0YV92aWV3LnNldEludDMyKDIwLCBvdXRwdXRfY2hhbm5lbHMsIHRydWUpOwogICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzYW1wbGUgPSAwOwogICAgICBpZiAob3V0cHV0X2NoYW5uZWxzID09PSAxKSB7CiAgICAgICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IGNoYW5uZWxzLmxlbmd0aDsgKytjaGFubmVsKSB7CiAgICAgICAgICBzYW1wbGUgKz0gY2hhbm5lbHNbY2hhbm5lbF1baV07CiAgICAgICAgfQogICAgICAgIHNhbXBsZSA9IE1hdGguZmxvb3IocmFuZ2VfbWF4ICogc2FtcGxlICogYW1wbGl0dWRlX3NjYWxlIC8gY2hhbm5lbHMubGVuZ3RoKTsKICAgICAgICBpZiAoc2FtcGxlIDwgbWluX3ZhbHVlWzBdKSB7CiAgICAgICAgICBtaW5fdmFsdWVbMF0gPSBzYW1wbGU7CiAgICAgICAgICBpZiAobWluX3ZhbHVlWzBdIDwgcmFuZ2VfbWluKSB7CiAgICAgICAgICAgIG1pbl92YWx1ZVswXSA9IHJhbmdlX21pbjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHNhbXBsZSA+IG1heF92YWx1ZVswXSkgewogICAgICAgICAgbWF4X3ZhbHVlWzBdID0gc2FtcGxlOwogICAgICAgICAgaWYgKG1heF92YWx1ZVswXSA+IHJhbmdlX21heCkgewogICAgICAgICAgICBtYXhfdmFsdWVbMF0gPSByYW5nZV9tYXg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoY2hhbm5lbCA9IDA7IGNoYW5uZWwgPCBvdXRwdXRfY2hhbm5lbHM7ICsrY2hhbm5lbCkgewogICAgICAgICAgc2FtcGxlID0gTWF0aC5mbG9vcihyYW5nZV9tYXggKiBjaGFubmVsc1tjaGFubmVsXVtpXSAqIGFtcGxpdHVkZV9zY2FsZSk7CiAgICAgICAgICBpZiAoc2FtcGxlIDwgbWluX3ZhbHVlW2NoYW5uZWxdKSB7CiAgICAgICAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IHNhbXBsZTsKICAgICAgICAgICAgaWYgKG1pbl92YWx1ZVtjaGFubmVsXSA8IHJhbmdlX21pbikgewogICAgICAgICAgICAgIG1pbl92YWx1ZVtjaGFubmVsXSA9IHJhbmdlX21pbjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHNhbXBsZSA+IG1heF92YWx1ZVtjaGFubmVsXSkgewogICAgICAgICAgICBtYXhfdmFsdWVbY2hhbm5lbF0gPSBzYW1wbGU7CiAgICAgICAgICAgIGlmIChtYXhfdmFsdWVbY2hhbm5lbF0gPiByYW5nZV9tYXgpIHsKICAgICAgICAgICAgICBtYXhfdmFsdWVbY2hhbm5lbF0gPSByYW5nZV9tYXg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCsrc2NhbGVfY291bnRlciA9PT0gc2NhbGUpIHsKICAgICAgICBmb3IgKGNoYW5uZWwgPSAwOyBjaGFubmVsIDwgb3V0cHV0X2NoYW5uZWxzOyBjaGFubmVsKyspIHsKICAgICAgICAgIGlmIChvcHRpb25zLmJpdHMgPT09IDgpIHsKICAgICAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1pbl92YWx1ZVtjaGFubmVsXSk7CiAgICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQ4KG9mZnNldCsrLCBtYXhfdmFsdWVbY2hhbm5lbF0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGF0YV92aWV3LnNldEludDE2KG9mZnNldCwgbWluX3ZhbHVlW2NoYW5uZWxdLCB0cnVlKTsKICAgICAgICAgICAgZGF0YV92aWV3LnNldEludDE2KG9mZnNldCArIDIsIG1heF92YWx1ZVtjaGFubmVsXSwgdHJ1ZSk7CiAgICAgICAgICAgIG9mZnNldCArPSA0OwogICAgICAgICAgfQogICAgICAgICAgbWluX3ZhbHVlW2NoYW5uZWxdID0gSW5maW5pdHk7CiAgICAgICAgICBtYXhfdmFsdWVbY2hhbm5lbF0gPSAtSW5maW5pdHk7CiAgICAgICAgfQogICAgICAgIHNjYWxlX2NvdW50ZXIgPSAwOwogICAgICB9CiAgICB9CiAgICBpZiAoc2NhbGVfY291bnRlciA+IDApIHsKICAgICAgZm9yIChjaGFubmVsID0gMDsgY2hhbm5lbCA8IG91dHB1dF9jaGFubmVsczsgY2hhbm5lbCsrKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuYml0cyA9PT0gOCkgewogICAgICAgICAgZGF0YV92aWV3LnNldEludDgob2Zmc2V0KyssIG1pbl92YWx1ZVtjaGFubmVsXSk7CiAgICAgICAgICBkYXRhX3ZpZXcuc2V0SW50OChvZmZzZXQrKywgbWF4X3ZhbHVlW2NoYW5uZWxdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YV92aWV3LnNldEludDE2KG9mZnNldCwgbWluX3ZhbHVlW2NoYW5uZWxdLCB0cnVlKTsKICAgICAgICAgIGRhdGFfdmlldy5zZXRJbnQxNihvZmZzZXQgKyAyLCBtYXhfdmFsdWVbY2hhbm5lbF0sIHRydWUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGJ1ZmZlcjsKICB9CgogIG9ubWVzc2FnZSA9IGZ1bmN0aW9uIG9ubWVzc2FnZShldnQpIHsKICAgIHZhciBidWZmZXIgPSBnZW5lcmF0ZVdhdmVmb3JtRGF0YShldnQuZGF0YSk7CgogICAgLy8gVHJhbnNmZXIgYnVmZmVyIHRvIHRoZSBjYWxsaW5nIHRocmVhZAogICAgdGhpcy5wb3N0TWVzc2FnZShidWZmZXIsIFtidWZmZXJdKTsKICAgIHRoaXMuY2xvc2UoKTsKICB9OwoKfSkoKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9d2F2ZWZvcm0tZGF0YS13b3JrZXIuanMubWFwCgo=",null,!1);function c(e){if(function(t){return t&&"object"===r(t)&&"sample_rate"in t&&"samples_per_pixel"in t&&"bits"in t&&"length"in t&&"data"in t}(e)&&(e=function(t){var e=t.data,n=t.channels||1,a=8===t.bits?1:2,i=2*t.length*n;if(e.length!==i)throw new Error("WaveformData.create(): Length mismatch in JSON waveform data");var s=24+e.length*a,r=new ArrayBuffer(s),g=new DataView(r);g.setInt32(0,2,!0),g.setUint32(4,8===t.bits,!0),g.setInt32(8,t.sample_rate,!0),g.setInt32(12,t.samples_per_pixel,!0),g.setInt32(16,t.length,!0),g.setInt32(20,n,!0);var h,I=24;if(8===t.bits)for(h=0;h<e.length;h++)g.setInt8(I++,e[h],!0);else for(h=0;h<e.length;h++)g.setInt16(I,e[h],!0),I+=2;return r}(e)),!function(t){var e=t&&"object"===r(t)&&"byteLength"in t;if(e){var n=new DataView(t).getInt32(0,!0);if(1!==n&&2!==n)throw new TypeError("WaveformData.create(): This waveform data version not supported")}return e}(e))throw new TypeError("WaveformData.create(): Unknown data format");this._data=new DataView(e),this._offset=2===this._version()?24:20,this._channels=[];for(var n=0;n<this.channels;n++)this._channels[n]=new t(this,n)}var _=512,A=8,m=1,d=!1,p=!1;function b(t,e,n){var a=function(t){for(var e=[],n=0;n<t.numberOfChannels;++n)e.push(t.getChannelData(n).buffer);return e}(t);if(e.disable_worker){var i=s({scale:e.scale,bits:e.bits,amplitude_scale:e.amplitude_scale,split_channels:e.split_channels,length:t.length,sample_rate:t.sampleRate,channels:a});n(null,new c(i),t)}else{var r=new C;r.onmessage=function(e){n(null,new c(e.data),t)},r.postMessage({scale:e.scale,bits:e.bits,amplitude_scale:e.amplitude_scale,split_channels:e.split_channels,length:t.length,sample_rate:t.sampleRate,channels:a},a)}}function f(t){this._inputData=t.waveformData,this._output_samples_per_pixel=t.scale,this._scale=this._inputData.scale,this._input_buffer_size=this._inputData.length;var e=this._input_buffer_size*this._inputData.scale,n=Math.ceil(e/this._output_samples_per_pixel),a=8===this._inputData.bits?1:2,i=24+2*n*this._inputData.channels*a;this._output_data=new ArrayBuffer(i),this.output_dataview=new DataView(this._output_data),this.output_dataview.setInt32(0,2,!0),this.output_dataview.setUint32(4,8===this._inputData.bits,!0),this.output_dataview.setInt32(8,this._inputData.sample_rate,!0),this.output_dataview.setInt32(12,this._output_samples_per_pixel,!0),this.output_dataview.setInt32(16,n,!0),this.output_dataview.setInt32(20,this._inputData.channels,!0),this._outputWaveformData=new c(this._output_data),this._input_index=0,this._output_index=0;var s,r=this._inputData.channels;for(this._min=new Array(r),this._max=new Array(r),s=0;s<r;++s)this._input_buffer_size>0?(this._min[s]=this._inputData.channel(s).min_sample(this._input_index),this._max[s]=this._inputData.channel(s).max_sample(this._input_index)):(this._min[s]=0,this._max[s]=0);this._min_value=8===this._inputData.bits?-128:-32768,this._max_value=8===this._inputData.bits?127:32767,this._where=0,this._prev_where=0,this._stop=0,this._last_input_index=0}return c.create=function(t){return new c(t)},c.createFromAudio=function(t,e){var n=function(t){return{scale:t.scale||_,bits:t.bits||A,amplitude_scale:t.amplitude_scale||m,split_channels:t.split_channels||d,disable_worker:t.disable_worker||p}}(t);if(t.audio_context&&t.array_buffer)return function(t,e,n,a){function i(t){t||(t=new DOMException("EncodingError")),a(t),a=function(){}}var s=t.decodeAudioData(e,(function(t){b(t,n,a)}),i);s&&s.catch(i)}(t.audio_context,t.array_buffer,n,e);if(t.audio_buffer)return b(t.audio_buffer,n,e);throw new TypeError("WaveformData.createFromAudio(): Pass either an AudioContext and ArrayBuffer, or an AudioBuffer object")},f.prototype.sample_at_pixel=function(t){return Math.floor(t*this._output_samples_per_pixel)},f.prototype.next=function(){for(var t,e,n,a=0,i=this._inputData.channels;this._input_index<this._input_buffer_size&&a<1e3;){for(;Math.floor(this.sample_at_pixel(this._output_index)/this._scale)===this._input_index;){if(this._output_index>0)for(n=0;n<i;++n)(t=this._outputWaveformData.channel(n)).set_min_sample(this._output_index-1,this._min[n]),t.set_max_sample(this._output_index-1,this._max[n]);if(this._last_input_index=this._input_index,this._output_index++,this._where=this.sample_at_pixel(this._output_index),this._prev_where=this.sample_at_pixel(this._output_index-1),this._where!==this._prev_where)for(n=0;n<i;++n)this._min[n]=this._max_value,this._max[n]=this._min_value}for(this._where=this.sample_at_pixel(this._output_index),this._stop=Math.floor(this._where/this._scale),this._stop>this._input_buffer_size&&(this._stop=this._input_buffer_size);this._input_index<this._stop;){for(n=0;n<i;++n)(e=(t=this._inputData.channel(n)).min_sample(this._input_index))<this._min[n]&&(this._min[n]=e),(e=t.max_sample(this._input_index))>this._max[n]&&(this._max[n]=e);this._input_index++}a++}if(this._input_index<this._input_buffer_size)return!1;if(this._input_index!==this._last_input_index)for(n=0;n<i;++n)(t=this._outputWaveformData.channel(n)).set_min_sample(this._output_index-1,this._min[n]),t.set_max_sample(this._output_index-1,this._max[n]);return!0},f.prototype.getOutputData=function(){return this._output_data},c.prototype={_getResampleOptions:function(t){var e={};if(e.scale=t.scale,e.width=t.width,null!=e.width&&("number"!=typeof e.width||e.width<=0))throw new RangeError("WaveformData.resample(): width should be a positive integer value");if(null!=e.scale&&("number"!=typeof e.scale||e.scale<=0))throw new RangeError("WaveformData.resample(): scale should be a positive integer value");if(!e.scale&&!e.width)throw new Error("WaveformData.resample(): Missing scale or width option");if(e.width&&(e.scale=Math.floor(this.duration*this.sample_rate/e.width)),e.scale<this.scale)throw new Error("WaveformData.resample(): Zoom level "+e.scale+" too low, minimum: "+this.scale);return e.abortSignal=t.abortSignal,e},resample:function(t){(t=this._getResampleOptions(t)).waveformData=this;for(var e=new f(t);!e.next(););return new c(e.getOutputData())},concat:function(){var t=this,e=Array.prototype.slice.call(arguments);e.forEach((function(e){if(t.channels!==e.channels||t.sample_rate!==e.sample_rate||t.bits!==e.bits||t.scale!==e.scale)throw new Error("WaveformData.concat(): Waveforms are incompatible")}));var n=this._concatBuffers.apply(this,e);return c.create(n)},_concatBuffers:function(){var t,e,n=Array.prototype.slice.call(arguments),a=this._offset,i=a,s=0,r=[this].concat(n).map((function(t){return t._data.buffer}));for(t=0;t<r.length;t++){e=r[t];var g=new DataView(e).getInt32(16,!0);i+=e.byteLength-a,s+=g}var h=new ArrayBuffer(i),I=new DataView(r[0]),l=new DataView(h);for(t=0;t<a;t++)l.setUint8(t,I.getUint8(t));l.setInt32(16,s,!0);var o=0,u=new Uint8Array(h,a);for(t=0;t<r.length;t++)e=r[t],u.set(new Uint8Array(e,a),o),o+=e.byteLength-a;return h},slice:function(t){var e=0,n=0;if(null!=t.startIndex&&null!=t.endIndex?(e=t.startIndex,n=t.endIndex):null!=t.startTime&&null!=t.endTime&&(e=this.at_time(t.startTime),n=this.at_time(t.endTime)),e<0)throw new RangeError("startIndex or startTime must not be negative");if(n<0)throw new RangeError("endIndex or endTime must not be negative");e>this.length&&(e=this.length),n>this.length&&(n=this.length),e>n&&(e=n);var a=n-e,i=8===this.bits?1:2,s=24+2*a*this.channels*i,r=new ArrayBuffer(s),g=new DataView(r);g.setInt32(0,2,!0),g.setUint32(4,8===this.bits,!0),g.setInt32(8,this.sample_rate,!0),g.setInt32(12,this.scale,!0),g.setInt32(16,a,!0),g.setInt32(20,this.channels,!0);for(var h=0;h<a*this.channels*2;h++){var I=this._at(e*this.channels*2+h);8===this.bits?g.setInt8(24+h,I):g.setInt16(24+2*h,I,!0)}return new c(r)},_version:function(){return this._data.getInt32(0,!0)},get length(){return this._data.getUint32(16,!0)},get bits(){return Boolean(this._data.getUint32(4,!0))?8:16},get duration(){return this.length*this.scale/this.sample_rate},get pixels_per_second(){return this.sample_rate/this.scale},get seconds_per_pixel(){return this.scale/this.sample_rate},get channels(){return 2===this._version()?this._data.getInt32(20,!0):1},channel:function(t){if(t>=0&&t<this._channels.length)return this._channels[t];throw new RangeError("Invalid channel: "+t)},get sample_rate(){return this._data.getInt32(8,!0)},get scale(){return this._data.getInt32(12,!0)},_at:function(t){return 8===this.bits?this._data.getInt8(this._offset+t):this._data.getInt16(this._offset+2*t,!0)},_set_at:function(t,e){return 8===this.bits?this._data.setInt8(this._offset+t,e):this._data.setInt16(this._offset+2*t,e,!0)},at_time:function(t){return Math.floor(t*this.sample_rate/this.scale)},time:function(t){return t*this.scale/this.sample_rate},toJSON:function(){for(var t={version:2,channels:this.channels,sample_rate:this.sample_rate,samples_per_pixel:this.scale,bits:this.bits,length:this.length,data:[]},e=0;e<this.length;e++)for(var n=0;n<this.channels;n++)t.data.push(this.channel(n).min_sample(e)),t.data.push(this.channel(n).max_sample(e));return t},toArrayBuffer:function(){return this._data.buffer}},c}));
//# sourceMappingURL=waveform-data.min.js.map
